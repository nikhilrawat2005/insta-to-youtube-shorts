<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Reel Upload Dashboard</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #0f172a;
            color: #e5e7eb;
            margin: 0;
            padding: 20px;
        }

        h1 {
            margin-bottom: 10px;
        }

        .container {
            max-width: 1000px;
            margin: auto;
        }

        .box {
            background: #111827;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        textarea {
            width: 100%;
            height: 100px;
            background: #020617;
            color: #e5e7eb;
            border: 1px solid #334155;
            border-radius: 5px;
            padding: 10px;
        }

        button {
            background: #2563eb;
            color: white;
            border: none;
            padding: 10px 18px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
        }

        button:hover {
            background: #1d4ed8;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }

        .stat-box {
            background: #020617;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-value {
            font-size: 26px;
            font-weight: bold;
            margin-top: 5px;
        }

        .logs {
            background: #020617;
            height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 13px;
            padding: 10px;
            border-radius: 6px;
            white-space: pre-wrap;
        }

        .footer {
            text-align: center;
            opacity: 0.6;
            font-size: 12px;
            margin-top: 20px;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>üé¨ Reel Upload System</h1>

    <!-- ADD LINKS -->
    <div class="box">
        <h3>üì• Store Reel Links</h3>
        <textarea id="linksInput" placeholder="Paste reel links here (one per line)"></textarea>
        <br>
        <button onclick="addLinks()">Save Links</button>
        <span id="addResult"></span>
    </div>

    <!-- START -->
    <div class="box">
        <h3>‚ñ∂Ô∏è Start Upload</h3>
        <button onclick="startUpload()">Start (1 Reel)</button>
    </div>

    <!-- STATS -->
    <div class="stats">
        <div class="stat-box">
            <h4>üì¶ Pending Links</h4>
            <div class="stat-value" id="pendingLinks">0</div>
        </div>

        <div class="stat-box">
            <h4>‚¨ÜÔ∏è Uploaded Today</h4>
            <div class="stat-value" id="todayUploads">0</div>
        </div>

        <div class="stat-box">
            <h4>‚è±Ô∏è Last Upload</h4>
            <div id="lastUploadTime">‚Äî</div>
            <div class="stat-value" id="timeSince">‚Äî</div>
        </div>
    </div>

    <!-- LOGS -->
    <div class="box">
        <h3>üßæ Engine Logs</h3>
        <div class="logs" id="logsBox">Loading...</div>
    </div>

    <div class="footer">
        Stable mode ‚Ä¢ One click = one upload
    </div>
</div>

<script>
    let lastUploadTimestamp = null;

    function addLinks() {
        const text = document.getElementById("linksInput").value;
        const links = text.split("\n").map(l => l.trim()).filter(Boolean);

        fetch("/add-links", {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify({links})
        })
        .then(res => res.json())
        .then(data => {
            document.getElementById("addResult").innerText =
                `‚úÖ Added ${data.added} new links`;
            document.getElementById("linksInput").value = "";
            loadStats();
        });
    }

    function startUpload() {
        fetch("/start", {method: "POST"})
            .then(res => res.json())
            .then(() => loadLogs());
    }

    function loadStats() {
        fetch("/stats")
            .then(res => res.json())
            .then(data => {
                document.getElementById("pendingLinks").innerText = data.pending_links;
                document.getElementById("todayUploads").innerText = data.today_uploads;

                if (data.last_upload_time) {
                    document.getElementById("lastUploadTime").innerText =
                        "Uploaded at: " + data.last_upload_time;
                    lastUploadTimestamp = new Date(data.last_upload_time.replace(" ", "T"));
                }
            });
    }

    function updateTimer() {
        if (!lastUploadTimestamp) return;

        const diff = Math.floor((Date.now() - lastUploadTimestamp.getTime()) / 1000);
        const h = Math.floor(diff / 3600);
        const m = Math.floor((diff % 3600) / 60);
        const s = diff % 60;

        document.getElementById("timeSince").innerText =
            `${h}h ${m}m ${s}s ago`;
    }

    function loadLogs() {
        fetch("/logs")
            .then(res => res.text())
            .then(text => {
                document.getElementById("logsBox").innerText = text;
            });
    }

    setInterval(loadStats, 5000);
    setInterval(loadLogs, 5000);
    setInterval(updateTimer, 1000);

    loadStats();
    loadLogs();
</script>

</body>
</html>
